<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atualizador de Dashboard VCA</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="card">
        <div class="card-header">
            <img src="data:image/png;base64,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" 
                 alt="Logo VCA" 
                 class="logo"
                 onerror="this.style.display='none'; document.getElementById('logo-text').style.display='block';">
            <div id="logo-text" style="display: none; color: white; font-size: 24px; font-weight: bold;">VCA Construtora</div>
        </div>

        <div class="card-body">
            <h1>Atualizador de Dashboard</h1>
            <p class="subtitle">Sincronize a planilha base com o dashboard do Google Sheets.</p>

            <form id="upload-form">
                <label for="file-input" class="file-label">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                    <span id="file-label-text">Clique para selecionar a planilha</span>
                </label>
                <input type="file" id="file-input" name="file" accept=".xlsx, .xls, .csv" required>
                
                <button type="submit" id="submit-button" class="btn-primary">
                    <span class="btn-text">Iniciar Sincronização</span>
                    <div class="spinner"></div>
                </button>
            </form>
        </div>

        <div class="card-footer">
            <h3>Log de Status</h3>
            <div id="log-output">
                <div class="log-entry log-info">
                    <svg class="log-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    <span>Aguardando início do processo...</span>
                </div>
            </div>
        </div>
    </div>

    <footer class="main-footer">
        <div class="footer-line"></div>
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo VCA" class="footer-logo">
        <p class="footer-name">Matheus Santos</p>
        <p class="footer-info">
            <span>Subsetor de Sistemas</span>
            <span class="separator">|</span>
            <span>Setor Imobiliário</span>
        </p>
    </footer>

    <!-- ===== SCRIPT ATUALIZADO PARA O VISUAL DE LOG ANTIGO ===== -->
    <script>
        const form = document.getElementById('upload-form');
        const fileInput = document.getElementById('file-input');
        const submitButton = document.getElementById('submit-button');
        const btnText = document.querySelector('.btn-text');
        const spinner = document.querySelector('.spinner');
        const logBox = document.getElementById('log-output');
        const fileLabelText = document.getElementById('file-label-text');

        const icons = {
            success: `<svg class="log-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`,
            error: `<svg class="log-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>`,
            info: `<svg class="log-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>`
        };

        function addLogEntry(message) {
            if (!message.trim()) return;

            let type = 'info';
            let icon = icons.info;

            // Define o tipo e o ícone com base em palavras-chave
            if (message.includes('[ATUALIZAÇÃO]') || message.includes('[NOVO]') || message.includes('✅')) {
                type = 'success';
                icon = icons.success;
            } else if (message.includes('❌') || message.includes('ERRO')) {
                type = 'error';
                icon = icons.error;
            }
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `${icon}<span>${message}</span>`;
            logBox.appendChild(logEntry);
        }

        fileInput.addEventListener('change', () => {
            fileLabelText.textContent = fileInput.files.length > 0 ? fileInput.files[0].name : 'Clique para selecionar a planilha';
        });

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            if (fileInput.files.length === 0) {
                logBox.innerHTML = '';
                addLogEntry('❌ ERRO: Por favor, selecione um arquivo primeiro.');
                return;
            }

            submitButton.disabled = true;
            btnText.style.display = 'none';
            spinner.style.display = 'block';
            logBox.innerHTML = '';
            addLogEntry('Iniciando processo de sincronização...');

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch('/upload', { method: 'POST', body: formData });
                const result = await response.json();
                
                logBox.innerHTML = '';
                if (result.success) {
                    result.log.split('\n').forEach(addLogEntry);
                } else {
                    addLogEntry(`❌ ERRO: ${result.error}`);
                }
            } catch (error) {
                logBox.innerHTML = '';
                addLogEntry(`❌ ERRO DE CONEXÃO: Não foi possível conectar ao servidor.`);
            } finally {
                submitButton.disabled = false;
                spinner.style.display = 'none';
                btnText.style.display = 'block';
                logBox.scrollTop = logBox.scrollHeight;
            }
        });
    </script>
</body>
</html>